{"version":3,"file":"gutenberg-panel.js","mappings":"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","sources":["webpack://post-expirator/./assets/jsx/gutenberg-panel/gutenberg-panel.jsx"],"sourcesContent":["(function (wp, config) {\n\n    const {registerPlugin} = wp.plugins;\n    const {PluginDocumentSettingPanel} = wp.editPost;\n    const {PanelRow, DateTimePicker, CheckboxControl, SelectControl, FormTokenField, Spinner} = wp.components;\n    const {Fragment, Component} = wp.element;\n    const {decodeEntities} = wp.htmlEntities;\n    const {isEmpty, keys, compact} = lodash;\n\n    class PostExpiratorSidebar extends Component {\n        constructor() {\n            super(...arguments);\n\n            this.state = {\n                categoriesList: [],\n                catIdVsName: [],\n                expirationEnabled: false,\n                expirationAction: '',\n                expirationDate: '',\n                expirationTerms: [],\n                expirationTaxonomy: ''\n            }\n\n            wp.data.subscribe(this.listenToPostSave.bind(this));\n            wp.hooks.addAction('after_save_post', 'publishpress-future', () => {\n                this.debugLog('getExpirationEnabled', this.getExpirationEnabled());\n                this.saveCurrentPostData()\n            });\n        }\n\n        debugLog(description, message) {\n            if (console && config.is_debug_enabled) {\n                console.log(description, message);\n            }\n        }\n\n        listenToPostSave() {\n            // Get the current post ID\n            const postId = this.getPostId();\n\n            const isSavingPost = this.getIsSavingPost();\n            const itemKey = 'ppfuture-expiration-' + postId + '-isSavingPost';\n\n            if (isSavingPost) {\n                sessionStorage.setItem(itemKey, '1');\n            }\n\n            if (!isSavingPost) {\n                let hasSavingRegistered = sessionStorage.getItem(itemKey) === '1';\n\n                if (hasSavingRegistered) {\n                    sessionStorage.removeItem(itemKey);\n                    wp.hooks.doAction('after_save_post', 'publishpress-future');\n                }\n            }\n        }\n\n        getPostType() {\n            return wp.data.select('core/editor').getCurrentPostType();\n        }\n\n        getPostId() {\n            return wp.data.select('core/editor').getCurrentPostId();\n        }\n\n        getIsSavingPost() {\n            return wp.data.select('core/editor').isSavingPost() || wp.data.select('core/editor').isAutosavingPost();\n        }\n\n        editPostAttribute(name, value) {\n            let attribute = {};\n            attribute[name] = value;\n\n            wp.data.dispatch('core/editor').editPost(attribute);\n        }\n\n        getEditedPostAttribute(name) {\n            return wp.data.select(\"core/editor\").getEditedPostAttribute(name);\n        }\n\n        fetchExpirationDataFromApi() {\n            return wp.apiFetch({path: 'publishpress-future/v1/post-expiration/' + this.getPostId()}).then((data) => {\n                this.editPostAttribute('expirationEnabled', data.enabled);\n                this.editPostAttribute('expirationAction', data.expireType);\n                this.editPostAttribute('expirationDate', data.date);\n                this.editPostAttribute('expirationTerms', data.category);\n                this.editPostAttribute('expirationTaxonomy', data.categoryTaxonomy);\n\n                this.setState({\n                    expirationEnabled: data.enabled,\n                    expirationAction: data.expireType,\n                    expirationDate: data.date,\n                    expirationTerms: data.category,\n                    expirationTaxonomy: data.categoryTaxonomy\n                });\n\n                this.debugLog('API return', data);\n            });\n        }\n\n        saveCurrentPostData() {\n            const {expirationEnabled, expirationDate, expirationAction, expirationTerms} = this.state;\n            let data;\n\n            this.debugLog('State', this.state);\n\n            if (!expirationEnabled) {\n                data = {'enabled': false, 'date': 0, 'action': '', 'terms': []};\n            } else {\n                data = {\n                    enabled: expirationEnabled,\n                    date: expirationDate,\n                    action: expirationAction,\n                    terms: expirationTerms,\n                };\n            }\n\n            wp.apiFetch({\n                path: 'publishpress-future/v1/post-expiration/' + this.getPostId(),\n                method: 'POST',\n                data: data,\n            }).then((data) => {\n                this.debugLog('Future action data saved.');\n                this.debugLog(data);\n            });\n        }\n\n        componentWillMount() {\n            this.fetchExpirationDataFromApi().then(this.initialize.bind(this));\n        }\n\n        initialize() {\n            const postType = this.getPostType();\n\n            const expirationEnabled = this.getExpirationEnabled();\n            const expirationAction = this.getExpirationAction();\n            const expirationTerms = this.getExpirationTerms();\n            const expirationDate = this.getExpirationDate();\n            const expirationTaxonomy = this.getExpirationTaxonomy();\n\n            this.debugLog('Initialized', {\n                enabled: expirationEnabled,\n                date: expirationDate,\n                expirationAction: expirationAction,\n                categories: expirationTerms,\n                taxonomy: expirationTaxonomy,\n            });\n\n            this.setState({\n                expirationEnabled: expirationEnabled,\n                expirationAction: expirationAction,\n                expirationDate: expirationDate,\n                expirationTerms: expirationTerms,\n                expirationTaxonomy: expirationTaxonomy\n            });\n\n            this.debugLog('Default config', config.defaults);\n\n            let categoriesList = [];\n            let catIdVsName = [];\n\n            if ((!expirationTaxonomy && postType === 'post') || expirationTaxonomy === 'category') {\n                wp.apiFetch({\n                    path: wp.url.addQueryArgs('wp/v2/categories', {per_page: -1}),\n                }).then((list) => {\n                    list.forEach(cat => {\n                        categoriesList[cat.name] = cat;\n                        catIdVsName[cat.id] = cat.name;\n                    });\n                    this.setState({\n                        categoriesList: categoriesList,\n                        catIdVsName: catIdVsName,\n                        taxonomy: config.strings.category\n                    });\n                });\n            } else {\n                wp.apiFetch({\n                    path: wp.url.addQueryArgs(`wp/v2/taxonomies/${expirationTaxonomy}`, {context: 'edit'}),\n                }).then((taxAttributes) => {\n                    // fetch all terms\n                    wp.apiFetch({\n                        path: wp.url.addQueryArgs(`wp/v2/${taxAttributes.rest_base}`, {context: 'edit'}),\n                    }).then((terms) => {\n                        terms.forEach(term => {\n                            categoriesList[decodeEntities(term.name)] = term;\n                            catIdVsName[term.id] = decodeEntities(term.name);\n                        });\n                        this.setState({\n                            categoriesList: categoriesList,\n                            catIdVsName: catIdVsName,\n                            taxonomy: decodeEntities(taxAttributes.name)\n                        });\n                    });\n                });\n            }\n        }\n\n        componentDidUpdate() {\n            const {expirationEnabled, expirationDate, expirationAction, expirationTerms, attribute} = this.state;\n            \n            switch (attribute) {\n                case 'enabled':\n                    this.editPostAttribute('expirationEnabled', expirationEnabled);\n                    break;\n\n                case 'date':\n                    this.editPostAttribute('expirationDate', expirationDate);\n                    break;\n\n                case 'action':\n                    this.editPostAttribute('expirationAction', expirationAction);\n                    if (!expirationAction.includes('category')) {\n                        this.editPostAttribute('expirationTerms', []);\n                    }\n                    break;\n                case 'category':\n                    this.editPostAttribute('expirationTerms', expirationTerms);\n                    break;\n            }\n        }\n\n        getExpirationEnabled() {\n            return this.getEditedPostAttribute('expirationEnabled') == true;\n        }\n\n        getExpirationDate() {\n            let storedDate = parseInt(this.getEditedPostAttribute('expirationDate'));\n\n            if (! storedDate) {\n                if (config.default_date) {\n                    storedDate = parseInt(config.default_date);\n                } else {\n                    storedDate = new Date().getTime();\n                }\n            }\n\n            let date = new Date();\n            // let browserTimezoneOffset = date.getTimezoneOffset() * 60;\n            // let wpTimezoneOffset = config.timezone_offset * 60;\n\n            // date.setTime((storedDate + browserTimezoneOffset + wpTimezoneOffset) * 1000);\n            date.setTime(storedDate * 1000);\n\n            return date.getTime()/1000;\n        }\n\n        // what action to take on expiration\n        getExpirationAction() {\n            let expirationAction = this.getEditedPostAttribute('expirationAction');\n\n            if (expirationAction) {\n                return expirationAction;\n            }\n\n            if (config && config.defaults && config.defaults.expireType) {\n                return config.defaults.expireType;\n            }\n\n            return 'draft';\n        }\n\n        arrayIsEmpty(obj) {\n            return !obj || obj.length === 0 || obj[0] === '';\n        }\n\n        // what categories to add/remove/replace\n        getExpirationTerms() {\n            let categories = this.getEditedPostAttribute('expirationTerms', true);\n\n            let defaultCategories = config.defaults.terms ? config.defaults.terms.split(',') : [];\n\n            if (this.arrayIsEmpty(categories)) {\n                return defaultCategories;\n            }\n\n            if (categories && typeof categories !== 'undefined' && typeof categories !== 'object') {\n                return [categories];\n            }\n\n            return categories;\n        }\n\n        getExpirationTaxonomy() {\n            let taxonomy = this.getEditedPostAttribute('expirationTaxonomy');\n\n            if (taxonomy) {\n                return taxonomy;\n            }\n\n            if (config && config.defaults && config.defaults.taxonomy) {\n                return config.defaults.taxonomy;\n            }\n\n            return 'category';\n        }\n\n        // fired for the autocomplete\n        selectCategories(tokens) {\n            const {categoriesList, catIdVsName} = this.state;\n\n            var hasNoSuggestion = tokens.some(function (token) {\n                return typeof token === 'string' && !categoriesList[token];\n            });\n\n            if (hasNoSuggestion) {\n                return;\n            }\n\n            var categories = tokens.map(function (token) {\n                return typeof token === 'string' ? categoriesList[token] : token;\n            })\n\n            return categories.map((cat) => cat.id);\n        }\n\n        onChangeEnabled(value) {\n            this.setState({expirationEnabled: value, attribute: 'enabled'})\n            this.editPostAttribute('expirationEnabled', value);\n            this.debugLog(value);\n        }\n\n        onChangeDate(value) {\n            const date = new Date(value).getTime()/1000;\n            this.setState({expirationDate: date, attribute: 'date'});\n            this.editPostAttribute('expirationDate', date);\n            this.debugLog('New date', date, new Date(date * 1000));\n            this.debugLog('Getdate', this.getExpirationDate());\n        }\n\n        onChangeAction(value) {\n            this.setState({expirationAction: value, attribute: 'action'})\n            this.editPostAttribute('expirationAction', value);\n        }\n\n        onChangeTerms(value) {\n            this.setState({\n                expirationTerms: this.selectCategories(value),\n                attribute: 'category'\n            });\n            this.editPostAttribute('expirationTerms', value);\n        }\n\n        render() {\n            const {categoriesList, catIdVsName} = this.state;\n            const {expirationEnabled, expirationDate, expirationAction, expirationTerms, expirationTaxonomy} = this.state;\n\n            let selectedCats = expirationTerms && compact(expirationTerms.map((id) => catIdVsName[id] || false));\n            if (typeof selectedCats === 'string') {\n                selectedCats = [];\n            }\n\n            return (\n                <PluginDocumentSettingPanel title={config.strings.postExpirator} icon=\"calendar\"\n                                            initialOpen={expirationEnabled} className={'post-expirator-panel'}>\n                    <PanelRow>\n                        <CheckboxControl\n                            label={config.strings.enablePostExpiration}\n                            checked={expirationEnabled}\n                            onChange={this.onChangeEnabled.bind(this)}\n                        />\n                    </PanelRow>\n                    {expirationEnabled && (\n                        <Fragment>\n                            <PanelRow>\n                                <DateTimePicker\n                                    currentDate={expirationDate*1000}\n                                    onChange={this.onChangeDate.bind(this)}\n                                    is12Hour={config.is_12_hours}\n                                />\n                            </PanelRow>\n                            <SelectControl\n                                label={config.strings.howToExpire}\n                                value={expirationAction}\n                                options={config.actions_options}\n                                onChange={this.onChangeAction.bind(this)}\n                            />\n                            {expirationAction.includes('category') &&\n                                (\n                                    (isEmpty(keys(categoriesList)) && (\n                                        <Fragment>\n                                            {config.strings.loading + ` (${expirationTaxonomy})`}\n                                            <Spinner/>\n                                        </Fragment>\n                                    ))\n                                    ||\n                                    (\n                                        <FormTokenField\n                                            label={config.strings.expirationCategories + ` (${expirationTaxonomy})`}\n                                            value={selectedCats}\n                                            suggestions={Object.keys(categoriesList)}\n                                            onChange={this.onChangeTerms.bind(this)}\n                                            maxSuggestions={10}\n                                        />\n                                    )\n                                )}\n                        </Fragment>\n                    )}\n                </PluginDocumentSettingPanel>\n            );\n        }\n    }\n\n    registerPlugin('postexpirator-sidebar', {\n        render: PostExpiratorSidebar\n    });\n\n})(window.wp, window.postExpiratorPanelConfig);\n"],"names":["wp","config","registerPlugin","PluginDocumentSettingPanel","PanelRow","DateTimePicker","CheckboxControl","SelectControl","FormTokenField","Spinner","Fragment","Component","decodeEntities","isEmpty","keys","compact","window","postExpiratorPanelConfig","plugins","editPost","components","element","htmlEntities","lodash","render","arguments","state","categoriesList","catIdVsName","expirationEnabled","expirationAction","expirationDate","expirationTerms","expirationTaxonomy","data","subscribe","listenToPostSave","bind","hooks","addAction","debugLog","getExpirationEnabled","saveCurrentPostData","description","message","console","is_debug_enabled","log","postId","this","getPostId","isSavingPost","getIsSavingPost","itemKey","sessionStorage","setItem","getItem","removeItem","doAction","select","getCurrentPostType","getCurrentPostId","isAutosavingPost","name","value","attribute","dispatch","getEditedPostAttribute","apiFetch","path","then","editPostAttribute","enabled","expireType","date","category","categoryTaxonomy","setState","action","terms","method","fetchExpirationDataFromApi","initialize","postType","getPostType","getExpirationAction","getExpirationTerms","getExpirationDate","getExpirationTaxonomy","categories","taxonomy","defaults","url","addQueryArgs","per_page","list","forEach","cat","id","strings","context","taxAttributes","rest_base","term","includes","storedDate","parseInt","default_date","Date","getTime","setTime","obj","length","defaultCategories","split","arrayIsEmpty","tokens","some","token","map","selectCategories","selectedCats","title","postExpirator","icon","initialOpen","className","label","enablePostExpiration","checked","onChange","onChangeEnabled","currentDate","onChangeDate","is12Hour","is_12_hours","howToExpire","options","actions_options","onChangeAction","loading","expirationCategories","suggestions","Object","onChangeTerms","maxSuggestions"],"sourceRoot":""}